# ############################################################
#
#  automation for ZB Charger 01 to switch it ON
#
# ############################################################

# ############################################################
# ZB Charger 01 turn off after x minutes
# ############################################################
- alias: Zigbee Charger 01 ON
  id: "e7ddfee3-d661-4618-b4ba-eb43950ce068"
  initial_state: true
  # --------------------- TRIGGER ---------------------
  # after the plug was on for x minutes the switch goes off
  trigger:
    - platform: template
      value_template: '{% if (states("sensor.spuhnote10pro_battery_level") | float(0)) < (states("input_number.l2_charger01_max_percentage") | float(0)) %}true{% endif %}'
  # -------------------- CONDITIONS -------------------
  condition:
    - and:
        # switch is OFF
        - condition: template
          value_template: "{{ states('switch.zb_charger_01') != 'on' }}"
        # charger functionalitity enabled
        - condition: template
          value_template: "{{ is_state('input_boolean.zb_charger_01_functionality', 'on') }}"
        # delayed charging disabled
        - condition: template
          value_template: "{{ is_state('input_boolean.zb_charger_01_force_delayed', 'off') }}"
  # --------------------- ACTIONS ---------------------
  action:
    # ------------------ ZB Plug OFF ------------------
    service: switch.turn_on
    entity_id: switch.zb_charger_01
# ############################################################
#  END OF FILE
# ############################################################
