# ############################################################
#
#  automation for ZB Charger 01 to switch it OFF
#
# ############################################################

# ############################################################
# ZB Charger 01 turn off after x minutes
# ############################################################
- alias: Zigbee Charger 01 Timer
  id: "29322f0c-002b-41c9-991c-be1aff542f1b"
  initial_state: true
  # --------------------- TRIGGER ---------------------
  # after the plug was on for x minutes the switch goes off
  trigger:
    - platform: template
      value_template: '{% if (states("sensor.spuhnote10pro_battery_level") | float(0)) > (states("input_number.l2_charger01_max_percentage") | float(0)) %}true{% endif %}'
    - platform: state
      entity_id: switch.zb_charger_01
      to: "on"
      for:
        hours: 1
        minutes: 45
  # -------------------- CONDITIONS -------------------
  condition:
    - and:
        # make sure that the owner of the switch is at home
        - condition: template
          value_template: "{{ states('binary_sensor.home_uwe_is_here') == 'on' }}"
        # switch is OFF
        - condition: template
          value_template: "{{ states('switch.zb_charger_01') == 'on' }}"
        # charger functionalitity enabled
        - condition: template
          value_template: "{{ is_state('input_boolean.zb_charger_01_functionality', 'on') }}"
        # no delayed start of charging
        - condition: template
          value_template: "{{ is_state('input_boolean.zb_charger_01_force_delayed', 'off') }}"
  # --------------------- ACTIONS ---------------------
  action:
    # ------------------ ZB Plug OFF ------------------
    service: switch.turn_off
    entity_id: switch.zb_charger_01
# ############################################################
#  END OF FILE
# ############################################################
