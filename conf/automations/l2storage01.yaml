# ############################################################
#
#  automation for l2storage01
#
# ############################################################

# ############################################################
# L2 Storage ON if motion detected
# ############################################################
- alias: L2 Storage ON if motion detected
  id: 'L2 Storage ON if motion detected'
  initial_state: true
  trigger:
    - platform: state
      entity_id: binary_sensor.l2_storage01_pir_01
      to: 'on'
    - platform: state
      entity_id: binary_sensor.l2_storage01_reed_01
      to: 'off'
  condition:
    - condition: template
      # only when civil twilight applies
      # for details see https://www.worldatlas.com/articles/what-is-the-difference-between-dusk-and-twilight.html
      # value_template: '{{ state_attr("sun.sun", "elevation")|float < 6 }}'
      value_template: "{{ is_state('binary_sensor.sun_dwn_twilight', 'on') }}"
  action:
    service: switch.turn_on
    entity_id: switch.l2_storage01_ssr_01

# ############################################################
# switch off the light after there is no motion for x minutes
# ############################################################
- alias: L2 Storage OFF post motion
  id: 'L2 Storage OFF post motion'
  initial_state: true
  trigger:
    - platform: state
      entity_id: binary_sensor.l2_storage01_pir_01
      to: 'off'
      for:
        minutes: 2
    - platform: state
      entity_id: binary_sensor.l2_storage01_reed_01
      to: 'on'
  action:
    service: switch.turn_off
    entity_id: switch.l2_storage01_ssr_01

# ############################################################
#  END OF FILE
# ############################################################
