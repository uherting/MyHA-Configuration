# ############################################################
#
#  Count Home Assistant errors and warnings (counting and notifications)
#
#   from: https://community.home-assistant.io/t/counter-warning-error-issue/85490/11
#
# ############################################################

# ############################################################
# Count Home Assistant errors
# ############################################################
- alias: Count Home Assistant errors
  id: "e15c4d86-ab37-4ac3-9e7a-556b73b66a11"
  initial_state: true
  # --------------------- TRIGGER ---------------------
  trigger:
    - platform: event
      event_type: system_log_event
      event_data:
        level: ERROR
  # -------------------- CONDITIONS -------------------
  # none whatsoever
  condition: []
  # --------------------- ACTIONS ---------------------
  action:
    # --------------------- NOTIFY ---------------------
    - service: counter.increment
      entity_id: counter.homeassistant_errors

# ############################################################
# Count Home Assistant warnings
# ############################################################
- alias: Count Home Assistant warnings
  id: "18261659-3d0e-48e5-b262-a05fdfbe8010"
  initial_state: true
  # --------------------- TRIGGER ---------------------
  trigger:
    - platform: event
      event_type: system_log_event
      event_data:
        level: WARNING
  # -------------------- CONDITIONS -------------------
  # none whatsoever
  condition: []
  # --------------------- ACTIONS ---------------------
  action:
    # --------------------- NOTIFY ---------------------
    - service: counter.increment
      entity_id: counter.homeassistant_warnings

# ############################################################
# Inform admin about Home Assistant errors
# ############################################################
- alias: Inform admin about Home Assistant errors
  id: "a9671476-d4e8-48be-a1d8-ff994e1078cb"
  initial_state: true
  # --------------------- TRIGGER ---------------------
  trigger:
    - platform: time
      at: "08:00:00"
  # -------------------- CONDITIONS -------------------
  # none whatsoever
  condition:
    - condition: numeric_state
      entity_id: counter.homeassistant_errors
      above: "0"
  # --------------------- ACTIONS ---------------------
  action:
    # ------------------- SEND NOTIFICATION -------------------
    - service: script.tg_txt
      data_template:
        msg_title: "Home Assistant errors"
        msg_text: "Since the last restart of HA {{ states(trigger.entity_id) | string }} error(s) occured.\n"
        msg_receiver: "admin"

# ############################################################
# Inform admin about Home Assistant warnings
# ############################################################
- alias: Inform admin about Home Assistant warnings
  id: "c4a32259-0632-4155-a923-6f5462bbc45e"
  initial_state: true
  # --------------------- TRIGGER ---------------------
  trigger:
    - platform: time
      at: "08:00:00"
  # -------------------- CONDITIONS -------------------
  # none whatsoever
  condition:
    - condition: numeric_state
      entity_id: counter.homeassistant_warnings
      above: "0"
  # --------------------- ACTIONS ---------------------
  action:
    # ------------------- SEND NOTIFICATION -------------------
    - service: script.tg_txt
      data_template:
        msg_title: "Home Assistant warnings"
        msg_text: "Since the last restart of HA {{ states(trigger.entity_id) | string }} warning(s) occured.\n"
        msg_receiver: "admin"
# ############################################################
#  END OF FILE
# ############################################################
