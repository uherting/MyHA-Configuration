# ############################################################
#
#  automation for l2storage01
#
# ############################################################

# ############################################################
# L2 Storage: toggle spy mode based on TB02 at l2storage01
# ############################################################
- alias: L2 Storage spy mode toggle
  id: "0a590c08-ad40-4181-a713-6c6b4c720939"
  initial_state: true
  # --------------------- TRIGGER ---------------------
  # double click binary_sensor.l2_storage01_bin_templ_spymode
  trigger:
    - platform: state
      id: "l2storage01_spymode_off"
      entity_id: binary_sensor.l2_storage01_bin_templ_spymode
      to: "off"
    - platform: state
      id: "l2storage01_spymode_on"
      entity_id: binary_sensor.l2_storage01_bin_templ_spymode
      to: "on"
  # --------------------- ACTIONS ---------------------
  action:
    - choose:
        - conditions:
            - condition: trigger
              id: "l2storage01_spymode_off"
          sequence:
            # ---------- SET AUTOMATION ACTIVE AGAIN ----------
            - service: automation.turn_on
              entity_id: automation.l2_storage_motion_detected_ssr01_on
        - conditions:
            - condition: trigger
              id: "l2storage01_spymode_on"
          sequence:
            # ------------ SET AUTOMATION INACTIVE ------------
            - service: automation.turn_off
              entity_id: automation.l2_storage_motion_detected_ssr01_on
      default:
        - service: script.tg_txt
          data:
            msg_title: "L2 Storage spy mode toggle problem"
            msg_text: ""
            msg_receiver: admin
        # - service: automation.turn_on
        #   entity_id: automation.l2_storage_motion_detected_ssr01_on
# ############################################################
#  END OF FILE
# ############################################################
