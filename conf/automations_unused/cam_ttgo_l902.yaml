# ############################################################
#
#  automation for L9_TTGO cam #02 notify with text / pics
#
# ############################################################

# ############################################################
# cam going online
# ############################################################
  - alias: Cam TTGO L9_02 went ONLINE
    id: 'Cam TTGO L9_02 ONLINE'
    initial_state: false
# --------------------- TRIGGER ---------------------
    trigger:
      - platform: state
        entity_id: binary_sensor.l9_cam_ttgo_02_status
        from: 'off'
        to: 'on'
# --------------------- ACTIONS ---------------------
    action:
# ------------------- SEND NOTIFICATION -------------------
      - service: script.send_msg_txt_via_tg
        data_template:
          msg_message: >
            TTGO cam L9 02 online again
            The cam became online at {{ states('sensor.date_time') }}
# ---------------------------------------------------------------

# ############################################################
# cam going offline
# ############################################################
  - alias: Cam TTGO L9_02 went OFFLINE
    id: 'Cam TTGO L9_02 OFFLINE'
    initial_state: false
# --------------------- TRIGGER ---------------------
    trigger:
      - platform: state
        entity_id: binary_sensor.l9_cam_ttgo_02_status
        from: 'on'
        to: 'off'
# --------------------- ACTIONS ---------------------
    action:
# ------------------- SEND NOTIFICATION -------------------
      - service: script.send_msg_txt_via_tg
        data_template:
          msg_message: >
            TTGO cam L9 02 went offline
            The cam went offline at {{ states('sensor.date_time') }}
# ---------------------------------------------------------------

# ############################################################
  - alias: Cam TTGO L9_02 PIR
    id: 'Cam TTGO L9_02 PIR'
    initial_state: true
# --------------------- TRIGGER ---------------------
    trigger:
      - platform: state
        entity_id: binary_sensor.l9_cam_ttgo_02_pir
        to: 'on'
# --------------------- ACTIONS ---------------------
    action:
# ------------------- CREATE SNAPSHOTS -------------------
#      - delay: '00:00:02'
      - service: camera.snapshot
        data:
          entity_id: camera.l9_cam_ttgo_02_cam
          filename: '/config/var/opt/tg/l9ttgocam02/1.jpg'
      - delay: '00:00:01'
      - service: camera.snapshot
        data:
          entity_id: camera.l9_cam_ttgo_02_cam
          filename: '/config/var/opt/tg/l9ttgocam02/2.jpg'
      - delay: '00:00:01'
      - service: camera.snapshot
        data:
          entity_id: camera.l9_cam_ttgo_02_cam
          filename: '/config/var/opt/tg/l9ttgocam02/3.jpg'
# ------------------- SEND NOTIFICATION -------------------
      - service: script.send_msg_txt_via_tg
        data:
          msg_title: "MOTION DETECTED"
          msg_message: "Motion was detected in area #1, 3 photos follow."

      - service: script.send_msg_files3_via_tg
        data:
          msg_filename_1: "/config/var/opt/tg/l9ttgocam02/1.jpg"
          msg_caption_1: "area 1, photo 1"
          msg_filename_2: "/config/var/opt/tg/l9ttgocam02/2.jpg"
          msg_caption_2: "area 1, photo 2"
          msg_filename_3: "/config/var/opt/tg/l9ttgocam02/3.jpg"
          msg_caption_3: "area 1, photo 3"
# ---------------------------------------------------------------

# ############################################################
#  END OF FILE
# ############################################################
