# ############################################################
#
#  ESPHome devices state changed
#
# ############################################################

# ############################################################
# ESPHome devices state changed
# ############################################################

- alias: ESPHome devices state changed 21 22
  id: "ESPHome devices state changed 21 22"
  initial_state: true
  trigger:
    platform: event
    event_type: state_changed
  condition:
    condition: and
    conditions:
      # domain is 'binary_sensor'
      - condition: template
        value_template: "{{ trigger.event.data.new_state.domain == 'binary_sensor' }}"

      # entity id starts with 'L0' / 'L2' / 'L9'
      - condition: template
        value_template: >
          {%- set new_state = trigger.event.data.new_state %}
          {%- set old_state = trigger.event.data.old_state %}
          {{ new_state.object_id.startswith('l0') }}

  action:
    - service: script.tg_txt
      data_template:
        msg_title: ESPHome dev change
        msg_text: Device {{ state_attr(trigger.event.data.entity_id, "friendly_name") }}
        msg_receiver: "admin"
############################################################
#  END OF FILE
# ############################################################
